} else {
df$average_compliance_observed_ini_lag <- NA
}
sem_model <- '
belief_compliance_pm ~ Trust_SA_Outgroup + Conflict_SA_Outgroup
belief_compliance_union ~ Trust_SA_Ingroup + Conflict_SA_Ingroup
average_compliance_ini ~ belief_compliance_pm + belief_compliance_union + Trust_SA_Outgroup + Conflict_SA_Outgroup + Trust_SA_Ingroup + Conflict_SA_Ingroup + average_compliance_observed_ini_lag
average_compliance_observed_ini_lag ~~ 0*belief_compliance_union
average_compliance_observed_ini_lag ~~ 0*belief_compliance_pm
Trust_SA_Outgroup ~~ 0*Conflict_SA_Outgroup
Trust_SA_Outgroup ~~ 0*Trust_SA_Ingroup
Trust_SA_Outgroup ~~ 0*Conflict_SA_Ingroup
Conflict_SA_Outgroup ~~ 0*Trust_SA_Ingroup
Conflict_SA_Outgroup ~~ 0*Conflict_SA_Ingroup
Trust_SA_Ingroup ~~ 0*Conflict_SA_Ingroup
'
node_labels <- c(
"belief_compliance_pm"                = expression(PB[italic(out) ~ "-" ~ italic(group)]),
"belief_compliance_union"             = expression(PB[italic(in)  ~ "-" ~ italic(group)]),
##############################
### Shared Area Round 2-8 - T2
#############################
set.seed(5326)
save_sharedarea_t2_dynamic_sem_plot <- function(df, R, N, path_github) {
cols <- get_columns_by_round("T2juegoalgas", "T2_extraccion_metat", R, N)
variable_subset <- df[, cols, drop = FALSE]
df$average_extraction_ini <- rowMeans(variable_subset, na.rm = TRUE)
df$average_compliance_ini <- 1 - (df$average_extraction_ini / 50)
df$belief_compliance_pm <- 1 - (df$beliefsT2inicial.1.player.T2_belief_caleta_conocida_mean_ini / 50)
df$belief_compliance_union <- 1 - (df$beliefsT2inicial.1.player.T2_belief_caleta_ini / 50)
df$Trust_SA_Outgroup<-(df$survey2.1.player.confianza_caleta_conocida_mean -1)/3
df$Conflict_SA_Outgroup<-(df$survey2.1.player.conflicto_caleta_conocida_mean -1)/3
df$Trust_SA_Ingroup<-(df$survey1.1.player.confianza_caleta -1)/3
df$Conflict_SA_Ingroup<-(df$survey1.1.player.conflicto_caleta -1)/3
if (R > 1) {
cols_obs <- get_columns_by_round("T2juegoalgas", "T2_extraccion_otros_metat", 1, R - 1)
variable_subset_obs <- df[, cols_obs, drop = FALSE]
df$average_extraction_observed_ini <- rowMeans(variable_subset_obs, na.rm = TRUE)
df$average_compliance_observed_ini_lag <- 1 - (df$average_extraction_observed_ini / 150)
} else {
df$average_compliance_observed_ini_lag <- NA
}
sem_model <- '
belief_compliance_pm ~ Trust_SA_Outgroup + Conflict_SA_Outgroup
belief_compliance_union ~ Trust_SA_Ingroup + Conflict_SA_Ingroup
average_compliance_ini ~ belief_compliance_pm + belief_compliance_union + Trust_SA_Outgroup + Conflict_SA_Outgroup + Trust_SA_Ingroup + Conflict_SA_Ingroup + average_compliance_observed_ini_lag
average_compliance_observed_ini_lag ~~ 0*belief_compliance_union
average_compliance_observed_ini_lag ~~ 0*belief_compliance_pm
Trust_SA_Outgroup ~~ 0*Conflict_SA_Outgroup
Trust_SA_Outgroup ~~ 0*Trust_SA_Ingroup
Trust_SA_Outgroup ~~ 0*Conflict_SA_Ingroup
Conflict_SA_Outgroup ~~ 0*Trust_SA_Ingroup
Conflict_SA_Outgroup ~~ 0*Conflict_SA_Ingroup
Trust_SA_Ingroup ~~ 0*Conflict_SA_Ingroup
'
node_labels <- c(
"belief_compliance_pm"                = expression(PB[italic(out) ~ "-" ~ italic(group)]),
"belief_compliance_union"             = expression(PB[italic("in")  ~ "-" ~ italic(group)]),
"average_compliance_ini"              = expression(bar(C)[i]),
"Trust_SA_Outgroup"                   = expression(Tst[italic(out) ~ "-" ~ italic(group)]),
"Conflict_SA_Outgroup"                = expression(Cft[italic(out) ~ "-" ~ italic(group)]),
"Trust_SA_Ingroup"                    = expression(Tst[italic("in")  ~ "-" ~ italic(group)]),
"Conflict_SA_Ingroup"                 = expression(Cft[italic("in")  ~ "-" ~ italic(group)]),
"average_compliance_observed_ini_lag" = expression(bar(C)[list(-i, t - 1)])
)
fit <- sem(sem_model,
data       = df,
estimator  = "ML",
se         = "bootstrap",
bootstrap  = 100,
parallel   = "multicore",
ncpus      = 4,
orthogonal = TRUE)
node_names <- semPlot::semPlotModel(fit)@Vars$name
cat("Node names detected for Shared Area T2 dynamic SEM labeling:\n")
print(node_names)
print(summary(fit))
paths <- parameterEstimates(fit, standardized = TRUE)
edge_colors <- ifelse(paths$pvalue[paths$op == "~"] < 0.05, "black", "transparent")
output_file <- paste0(path_github, "Outputs/SEM_sharedarea_T2_dynamic_plot_Rounds_ClusterLag1_rescaled_2d", R+8, "_to_", N+8, ".pdf")
pdf(output_file, width = 12, height = 8)
semPaths(
fit,
what = "std",
layout = "tree",
edge.label.cex = 1,
nodeLabels = node_labels,
sizeMan = 7,
label.cex = 1,
node.width = 2,
#node.height = 1,
shapeMan = "rectangle",
edge.color = edge_colors,
residuals = FALSE,
intercepts = FALSE,
optimizeLatRes = TRUE,
fade = FALSE,
nCharNodes = 25,
mar = c(6, 6, 7, 6)
)
title(main = paste("Shared Area (Know Out-group) Mean Rounds", R+8, "to", N+8), line = 2, cex.main = 1.5)
dev.off()
}
# Usage:
save_sharedarea_t2_dynamic_sem_plot(df, 2, 8, path_github)
#################
set.seed(5326)
save_sharedarea_t2_dynamic_sem_plot <- function(df, R, N, path_github) {
cols <- get_columns_by_round("T2juegoalgas", "T2_extraccion_metat", R, N)
variable_subset <- df[, cols, drop = FALSE]
df$average_extraction_ini <- rowMeans(variable_subset, na.rm = TRUE)
df$average_compliance_ini <- 1 - (df$average_extraction_ini / 50)
df$belief_compliance_pm <- 1 - (df$beliefsT2inicial.1.player.T2_belief_caleta_conocida_mean_ini / 50)
df$belief_compliance_union <- 1 - (df$beliefsT2inicial.1.player.T2_belief_caleta_ini / 50)
df$Trust_SA_Outgroup<-(df$survey2.1.player.confianza_caleta_conocida_mean -1)/3
df$Conflict_SA_Outgroup<-(df$survey2.1.player.conflicto_caleta_conocida_mean -1)/3
df$Trust_SA_Ingroup<-(df$survey1.1.player.confianza_caleta -1)/3
df$Conflict_SA_Ingroup<-(df$survey1.1.player.conflicto_caleta -1)/3
if (R > 1) {
cols_obs <- get_columns_by_round("T2juegoalgas", "T2_extraccion_otros_metat", 1, R - 1)
variable_subset_obs <- df[, cols_obs, drop = FALSE]
df$average_extraction_observed_ini <- rowMeans(variable_subset_obs, na.rm = TRUE)
df$average_compliance_observed_ini_lag <- 1 - (df$average_extraction_observed_ini / 150)
} else {
df$average_compliance_observed_ini_lag <- NA
}
sem_model <- '
belief_compliance_pm ~ Trust_SA_Outgroup + Conflict_SA_Outgroup
belief_compliance_union ~ Trust_SA_Ingroup + Conflict_SA_Ingroup
average_compliance_ini ~ belief_compliance_pm + belief_compliance_union + Trust_SA_Outgroup + Conflict_SA_Outgroup + Trust_SA_Ingroup + Conflict_SA_Ingroup + average_compliance_observed_ini_lag
average_compliance_observed_ini_lag ~~ 0*belief_compliance_union
average_compliance_observed_ini_lag ~~ 0*belief_compliance_pm
Trust_SA_Outgroup ~~ 0*Conflict_SA_Outgroup
Trust_SA_Outgroup ~~ 0*Trust_SA_Ingroup
Trust_SA_Outgroup ~~ 0*Conflict_SA_Ingroup
Conflict_SA_Outgroup ~~ 0*Trust_SA_Ingroup
Conflict_SA_Outgroup ~~ 0*Conflict_SA_Ingroup
Trust_SA_Ingroup ~~ 0*Conflict_SA_Ingroup
'
node_labels <- c(
"belief_compliance_pm"                = expression(PB[italic(out) ~ "-" ~ italic(group)]),
"belief_compliance_union"             = expression(PB[italic("in")  ~ "-" ~ italic(group)]),
"average_compliance_ini"              = expression(bar(C)[italic(i)]),
"Trust_SA_Outgroup"                   = expression(Tst[italic(out) ~ "-" ~ italic(group)]),
"Conflict_SA_Outgroup"                = expression(Cft[italic(out) ~ "-" ~ italic(group)]),
"Trust_SA_Ingroup"                    = expression(Tst[italic("in")  ~ "-" ~ italic(group)]),
"Conflict_SA_Ingroup"                 = expression(Cft[italic("in")  ~ "-" ~ italic(group)]),
"average_compliance_observed_ini_lag" = expression(bar(C)[italic(list(-i, t - 1))])
)
fit <- sem(sem_model,
data       = df,
estimator  = "ML",
se         = "bootstrap",
bootstrap  = 100,
parallel   = "multicore",
ncpus      = 4,
orthogonal = TRUE)
node_names <- semPlot::semPlotModel(fit)@Vars$name
cat("Node names detected for Shared Area T2 dynamic SEM labeling:\n")
print(node_names)
print(summary(fit))
paths <- parameterEstimates(fit, standardized = TRUE)
edge_colors <- ifelse(paths$pvalue[paths$op == "~"] < 0.05, "black", "transparent")
output_file <- paste0(path_github, "Outputs/SEM_sharedarea_T2_dynamic_plot_Rounds_ClusterLag1_rescaled_2d", R+8, "_to_", N+8, ".pdf")
pdf(output_file, width = 12, height = 8)
semPaths(
fit,
what = "std",
layout = "tree",
edge.label.cex = 1,
nodeLabels = node_labels,
sizeMan = 7,
label.cex = 1,
node.width = 2,
#node.height = 1,
shapeMan = "rectangle",
edge.color = edge_colors,
residuals = FALSE,
intercepts = FALSE,
optimizeLatRes = TRUE,
fade = FALSE,
nCharNodes = 25,
mar = c(6, 6, 7, 6)
)
title(main = paste("Shared Area (Know Out-group) Mean Rounds", R+8, "to", N+8), line = 2, cex.main = 1.5)
dev.off()
}
# Usage:
save_sharedarea_t2_dynamic_sem_plot(df, 2, 8, path_github)
set.seed(5326)
save_sharedarea_t2_dynamic_sem_plot <- function(df, R, N, path_github) {
cols <- get_columns_by_round("T2juegoalgas", "T2_extraccion_metat", R, N)
variable_subset <- df[, cols, drop = FALSE]
df$average_extraction_ini <- rowMeans(variable_subset, na.rm = TRUE)
df$average_compliance_ini <- 1 - (df$average_extraction_ini / 50)
df$belief_compliance_pm <- 1 - (df$beliefsT2inicial.1.player.T2_belief_caleta_conocida_mean_ini / 50)
df$belief_compliance_union <- 1 - (df$beliefsT2inicial.1.player.T2_belief_caleta_ini / 50)
df$Trust_SA_Outgroup<-(df$survey2.1.player.confianza_caleta_conocida_mean -1)/3
df$Conflict_SA_Outgroup<-(df$survey2.1.player.conflicto_caleta_conocida_mean -1)/3
df$Trust_SA_Ingroup<-(df$survey1.1.player.confianza_caleta -1)/3
df$Conflict_SA_Ingroup<-(df$survey1.1.player.conflicto_caleta -1)/3
if (R > 1) {
cols_obs <- get_columns_by_round("T2juegoalgas", "T2_extraccion_otros_metat", 1, R - 1)
variable_subset_obs <- df[, cols_obs, drop = FALSE]
df$average_extraction_observed_ini <- rowMeans(variable_subset_obs, na.rm = TRUE)
df$average_compliance_observed_ini_lag <- 1 - (df$average_extraction_observed_ini / 150)
} else {
df$average_compliance_observed_ini_lag <- NA
}
sem_model <- '
belief_compliance_pm ~ Trust_SA_Outgroup + Conflict_SA_Outgroup
belief_compliance_union ~ Trust_SA_Ingroup + Conflict_SA_Ingroup
average_compliance_ini ~ belief_compliance_pm + belief_compliance_union + Trust_SA_Outgroup + Conflict_SA_Outgroup + Trust_SA_Ingroup + Conflict_SA_Ingroup + average_compliance_observed_ini_lag
average_compliance_observed_ini_lag ~~ 0*belief_compliance_union
average_compliance_observed_ini_lag ~~ 0*belief_compliance_pm
'
node_labels <- c(
"belief_compliance_pm"                = expression(PB[italic(out) ~ "-" ~ italic(group)]),
"belief_compliance_union"             = expression(PB[italic("in")  ~ "-" ~ italic(group)]),
"average_compliance_ini"              = expression(bar(C)[italic(i)]),
"Trust_SA_Outgroup"                   = expression(Tst[italic(out) ~ "-" ~ italic(group)]),
"Conflict_SA_Outgroup"                = expression(Cft[italic(out) ~ "-" ~ italic(group)]),
"Trust_SA_Ingroup"                    = expression(Tst[italic("in")  ~ "-" ~ italic(group)]),
"Conflict_SA_Ingroup"                 = expression(Cft[italic("in")  ~ "-" ~ italic(group)]),
"average_compliance_observed_ini_lag" = expression(bar(C)[italic(list(-i, t - 1))])
)
fit <- sem(sem_model,
data       = df,
estimator  = "ML",
se         = "bootstrap",
bootstrap  = 100,
parallel   = "multicore",
ncpus      = 4,
orthogonal = TRUE)
node_names <- semPlot::semPlotModel(fit)@Vars$name
cat("Node names detected for Shared Area T2 dynamic SEM labeling:\n")
print(node_names)
print(summary(fit))
paths <- parameterEstimates(fit, standardized = TRUE)
edge_colors <- ifelse(paths$pvalue[paths$op == "~"] < 0.05, "black", "transparent")
output_file <- paste0(path_github, "Outputs/SEM_sharedarea_T2_dynamic_plot_Rounds_ClusterLag1_rescaled_", R+8, "_to_", N+8, ".pdf")
pdf(output_file, width = 12, height = 8)
semPaths(
fit,
what = "std",
layout = "tree",
edge.label.cex = 1,
nodeLabels = node_labels,
sizeMan = 7,
label.cex = 1,
node.width = 2,
#node.height = 1,
shapeMan = "rectangle",
edge.color = edge_colors,
residuals = FALSE,
intercepts = FALSE,
optimizeLatRes = TRUE,
fade = FALSE,
nCharNodes = 25,
mar = c(6, 6, 7, 6)
)
title(main = paste("Shared Area (Know Out-group) Mean Rounds", R+8, "to", N+8), line = 2, cex.main = 1.5)
dev.off()
}
# Usage:
save_sharedarea_t2_dynamic_sem_plot(df, 2, 8, path_github)
# --- Packages ---------------------------------------------------------------
library(dplyr)
library(tidyr)
library(lme4)
library(boot)
library(modelsummary)
library(broom.mixed)
library(tinytable)
library(rlang)
library(flextable)     # for DOCX
library(officer)       # for DOCX
options(modelsummary_factory_default = "flextable")  # force DOCX via flextable
rm(list=ls())
path_github <-"C:/Users/DCCS2/Documents/GitHub/Multi-level-collective-action-in-small-scale-fisheries/Exptal Sessions/R/"
path_datos<-"C:/Users/DCCS2/Dropbox/CICS/Experiments/Islitas/Data/Sessions"
#path_github <-"C:/Users/Denise Laroze/Documents/GitHub/Multi-level-collective-action-in-small-scale-fisheries/Exptal Sessions/R/"
#path_datos<-"C:/Users/Denise Laroze/Dropbox/CICS/Experiments/Islitas/Data/Sessions"
setwd(path_github)
#load(paste0(path_datos, "/Datos_islitas.Rdata"))
load(paste0(path_datos, "/Datos_islitas_recode.Rdata"))
load(paste0(path_datos, "/Datos_islitas_long.Rdata"))
### Data management
dfs_long <- dfs_long %>%
mutate(
confianza_pm_scaled      = (survey1.1.player.confianza_pm- 1) / 3,
conflicto_pm_scaled      = (survey1.1.player.conflicto_pm- 1) / 3,
confianza_caleta_scaled  = (survey1.1.player.confianza_caleta- 1) / 3,
conflicto_caleta_scaled  = (survey1.1.player.conflicto_caleta- 1) / 3
)
dfs_long$round.plm<-ifelse(dfs_long$treatment=="T2", as.numeric(dfs_long$round)+8, as.numeric(dfs_long$round))
dfs_long$participant.code.plm<-ifelse(dfs_long$treatment=="T2", paste0(dfs_long$participant.code, ".T2"), dfs_long$participant.code)
# --- Clustered bootstrap helper --------------------------------------------
bootstrap_lmer <- function(model_formula, data, cluster_var, B = 100, seed = 62354234) {
# coefficient skeleton
coef_names <- names(fixef(lmer(model_formula, data = data, control = ctrl, REML = FALSE)))
# one bootstrap replication (cluster resampling with replacement)
one_rep <- function(d, i_unused) {
clusters <- unique(stats::na.omit(d[[cluster_var]]))   # <-- drop NA clusters
if (length(clusters) < 2L) return(setNames(rep(NA_real_, length(coef_names)), coef_names))
samp <- sample(clusters, length(clusters), replace = TRUE)
d_b <- dplyr::bind_rows(lapply(samp, function(cl) d[d[[cluster_var]] == cl, , drop = FALSE]))
fit <- try(lmer(model_formula, data = d_b, control = ctrl, REML = FALSE), silent = TRUE)
out <- setNames(rep(NA_real_, length(coef_names)), coef_names)
if (inherits(fit, "try-error")) return(out)
cf <- try(fixef(fit), silent = TRUE)
if (!inherits(cf, "try-error")) out[names(cf)] <- cf
out
}
set.seed(seed)
bt <- boot::boot(data = data,
statistic = function(d, i) one_rep(d, i),
R = B)
draws <- bt$t
colnames(draws) <- coef_names
V <- stats::cov(draws, use = "pairwise.complete.obs")
se <- sqrt(diag(V))
list(boot = bt, V = V, se = se, coef_names = coef_names)
}
#####
oa_m1 <- compliance_extraction_OA ~
compliance_lag_extraction_others_OA_mean +
treatment*confianza_pm_scaled + treatment*conflicto_pm_scaled +
confianza_caleta_scaled + conflicto_caleta_scaled +
(1 | participant.code.plm)
oa_m2 <- compliance_extraction_OA ~
compliance_lag_extraction_others_OA_mean +
compliance_beliefs_OA_caleta + compliance_beliefs_OA_others +
treatment +
(1 | participant.code.plm)
oa_m3 <- compliance_extraction_OA ~
compliance_lag_extraction_others_OA_mean +
compliance_beliefs_OA_caleta + compliance_beliefs_OA_others*treatment +
(1 | participant.code.plm)
# oa_m4 <- compliance_extraction_OA ~
#   compliance_lag_extraction_others_OA_mean +
#   compliance_beliefs_OA_caleta + compliance_beliefs_OA_others +
#   treatment + minority + n_identities +
#   confianza_pm_scaled + conflicto_pm_scaled +
#   confianza_caleta_scaled + conflicto_caleta_scaled +
#   (1 | participant.code.plm)
oa_m4 <- compliance_extraction_OA ~
#compliance_lag_extraction_others_OA_mean +
treatment*confianza_pm_scaled + treatment*conflicto_pm_scaled +
compliance_beliefs_OA_caleta + compliance_beliefs_OA_others +
treatment + minority + n_identities +
confianza_caleta_scaled + conflicto_caleta_scaled +
survey3.1.player.sexo + survey3.1.player.horas_trabajo +
survey3.1.player.estudios + survey3.1.player.liderazgo +
(1 | participant.code.plm)
ctrl <- lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1e5))
# --- Fit full-sample models (point estimates) ---
oaplm1 <- lmer(oa_m1, data = dfs_long, control = ctrl, REML = FALSE)
oaplm2 <- lmer(oa_m2, data = dfs_long, control = ctrl, REML = FALSE)
oaplm3 <- lmer(oa_m3, data = dfs_long, control = ctrl, REML = FALSE)
oaplm4 <- lmer(oa_m4, data = dfs_long, control = ctrl, REML = FALSE)
# --- Clustered bootstrap (by OA cluster) ---
B <- 200  # bump to 500–1000 for the paper
oa1 <- bootstrap_lmer(oa_m1, dfs_long, "gid.treat", B = B)
oa2 <- bootstrap_lmer(oa_m2, dfs_long, "gid.treat", B = B)
oa3 <- bootstrap_lmer(oa_m3, dfs_long, "gid.treat", B = B)
oa4 <- bootstrap_lmer(oa_m4, dfs_long, "gid.treat", B = B)
# --- Export a single DOCX table with bootstrapped SEs ---
# A dictionary that renames but never drops terms.
# Include both ':' and ' × ' versions for interactions so it works regardless of pretty rewriting.
coef_dict <- c(
"(Intercept)"                                  = "(Intercept)",
"compliance_lag_extraction_others_OA_mean"     = "Mean observed compliance (t-1)",
"treatmentT2"                                  = "Stage (Known outsiders)",
"confianza_pm_scaled"                          = "Trust (outsiders)",
"conflicto_pm_scaled"                          = "Conflict (outsiders)",
"treatmentT2:confianza_pm_scaled"              = "Stage × Trust (outsiders)",
"treatmentT2:conflicto_pm_scaled"              = "Stage × Conflict (outsiders)",
"treatmentT2 × confianza_pm_scaled"            = "Stage × Trust (outsiders)",
"treatmentT2 × conflicto_pm_scaled"            = "Stage × Conflict (outsiders)",
"confianza_caleta_scaled"                      = "Trust (TURF)",
"conflicto_caleta_scaled"                      = "Conflict (TURF)",
"compliance_beliefs_OA_caleta"                 = "Prior belief (TURF)",
"compliance_beliefs_OA_others"                 = "Prior belief (outsiders)",
"minority"                                     = "Minority in round",
"n_identities"                                 = "Three unions",
"survey3.1.player.sexo"                        = "Female",
"survey3.1.player.horas_trabajo"               = "Hours worked per week",
"survey3.1.player.estudios"                    = "Education level",
"survey3.1.player.liderazgoSí"                 = "Held leadership role",
"SD (Intercept participant.code.plm)"          = "SD (Intercept participant)",
"SD (Observations)"                            = "SD (Residual)"
)
# Optional: if you’d rather *stop* the automatic '×' rewrite entirely, uncomment:
# options(modelsummary_rewrite_terms = FALSE)
mods <- list(
"SA: Base"                        = oaplm1,
"SA: Base + Trust/Conflict TURF"  = oaplm2,
"SA: Beliefs"                     = oaplm3,
"SA: Full"                        = oaplm4
)
vcvs <- list(oa1$V, oa2$V, oa3$V, oa4$V)
out_file_oa <- paste0(path_github, "Outputs/LMM_boot_H3_SharedArea_presentation.docx")
modelsummary(
mods,
#vcov        = vcvs,
coef_rename = coef_dict,                 # rename without dropping anything
statistic   = "({std.error})",
stars       = c("*"=.05,"**"=.01,"***"=.001),
gof_omit    = "^(AIC|BIC|ICC|RMSE)$",
output      = out_file_oa
)
oa_m1 <- compliance_extraction_OA ~
compliance_lag_extraction_others_OA_mean +
treatment*confianza_pm_scaled + treatment*conflicto_pm_scaled +
confianza_caleta_scaled + conflicto_caleta_scaled +
(1 | participant.code.plm)
oa_m2 <- compliance_extraction_OA ~
compliance_lag_extraction_others_OA_mean +
compliance_beliefs_OA_caleta + compliance_beliefs_OA_others +
treatment +
(1 | participant.code.plm)
oa_m3 <- compliance_extraction_OA ~
compliance_lag_extraction_others_OA_mean +
compliance_beliefs_OA_caleta + compliance_beliefs_OA_others*treatment +
(1 | participant.code.plm)
# oa_m4 <- compliance_extraction_OA ~
#   compliance_lag_extraction_others_OA_mean +
#   compliance_beliefs_OA_caleta + compliance_beliefs_OA_others +
#   treatment + minority + n_identities +
#   confianza_pm_scaled + conflicto_pm_scaled +
#   confianza_caleta_scaled + conflicto_caleta_scaled +
#   (1 | participant.code.plm)
oa_m4 <- compliance_extraction_OA ~
#compliance_lag_extraction_others_OA_mean +
treatment*confianza_pm_scaled + treatment*conflicto_pm_scaled +
compliance_beliefs_OA_caleta + compliance_beliefs_OA_others +
treatment + minority + n_identities +
confianza_caleta_scaled + conflicto_caleta_scaled +
survey3.1.player.sexo + survey3.1.player.horas_trabajo +
survey3.1.player.estudios + survey3.1.player.liderazgo +
(1 | participant.code.plm)
ctrl <- lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1e5))
# --- Fit full-sample models (point estimates) ---
oaplm1 <- lmer(oa_m1, data = dfs_long, control = ctrl, REML = FALSE)
oaplm2 <- lmer(oa_m2, data = dfs_long, control = ctrl, REML = FALSE)
oaplm3 <- lmer(oa_m3, data = dfs_long, control = ctrl, REML = FALSE)
oaplm4 <- lmer(oa_m4, data = dfs_long, control = ctrl, REML = FALSE)
# --- Clustered bootstrap (by OA cluster) ---
B <- 200  # bump to 500–1000 for the paper
oa1 <- bootstrap_lmer(oa_m1, dfs_long, "gid.treat", B = B)
oa2 <- bootstrap_lmer(oa_m2, dfs_long, "gid.treat", B = B)
oa3 <- bootstrap_lmer(oa_m3, dfs_long, "gid.treat", B = B)
oa4 <- bootstrap_lmer(oa_m4, dfs_long, "gid.treat", B = B)
# --- Export a single DOCX table with bootstrapped SEs ---
# A dictionary that renames but never drops terms.
# Include both ':' and ' × ' versions for interactions so it works regardless of pretty rewriting.
coef_dict <- c(
"(Intercept)"                                  = "(Intercept)",
"compliance_lag_extraction_others_OA_mean"     = "Mean observed compliance (t-1)",
"treatmentT2"                                  = "Stage (Known out-group)",
"confianza_pm_scaled"                          = "Trust (out-group)",
"conflicto_pm_scaled"                          = "Conflict (out-group)",
"treatmentT2:confianza_pm_scaled"              = "Stage × Trust (out-group)",
"treatmentT2:conflicto_pm_scaled"              = "Stage × Conflict (out-group)",
"treatmentT2 × confianza_pm_scaled"            = "Stage × Trust (out-group)",
"treatmentT2 × conflicto_pm_scaled"            = "Stage × Conflict (out-group)",
"compliance_beliefs_OA_others:treatmentT2"     = "Beliefs out-group x Stage"
"confianza_caleta_scaled"                      = "Trust (Union)",
coef_dict <- c(
"(Intercept)"                                  = "(Intercept)",
"compliance_lag_extraction_others_OA_mean"     = "Mean observed compliance (t-1)",
"treatmentT2"                                  = "Stage (Known out-group)",
"confianza_pm_scaled"                          = "Trust (out-group)",
"conflicto_pm_scaled"                          = "Conflict (out-group)",
"treatmentT2:confianza_pm_scaled"              = "Stage × Trust (out-group)",
"treatmentT2:conflicto_pm_scaled"              = "Stage × Conflict (out-group)",
"treatmentT2 × confianza_pm_scaled"            = "Stage × Trust (out-group)",
"treatmentT2 × conflicto_pm_scaled"            = "Stage × Conflict (out-group)",
"compliance_beliefs_OA_others:treatmentT2"     = "Beliefs out-group x Stage",
"confianza_caleta_scaled"                      = "Trust (Union)",
"conflicto_caleta_scaled"                      = "Conflict (in-group)",
"compliance_beliefs_OA_caleta"                 = "Prior beliefs (in-group)",
"compliance_beliefs_OA_others"                 = "Prior beliefs (out-group)",
"minority"                                     = "Minority in round",
"n_identities"                                 = "Three unions",
"survey3.1.player.sexo"                        = "Female",
"survey3.1.player.horas_trabajo"               = "Hours worked per week",
"survey3.1.player.estudios"                    = "Education level",
"survey3.1.player.liderazgoSí"                 = "Held leadership role",
"SD (Intercept participant.code.plm)"          = "SD (Intercept participant)",
"SD (Observations)"                            = "SD (Residual)"
)
# Optional: if you’d rather *stop* the automatic '×' rewrite entirely, uncomment:
# options(modelsummary_rewrite_terms = FALSE)
mods <- list(
"SA: Base"                        = oaplm1,
"SA: Base + Trust/Conflict TURF"  = oaplm2,
"SA: Beliefs"                     = oaplm3,
"SA: Full"                        = oaplm4
)
vcvs <- list(oa1$V, oa2$V, oa3$V, oa4$V)
out_file_oa <- paste0(path_github, "Outputs/LMM_boot_H3_SharedArea_presentation.docx")
modelsummary(
mods,
#vcov        = vcvs,
coef_rename = coef_dict,                 # rename without dropping anything
statistic   = "({std.error})",
stars       = c("*"=.05,"**"=.01,"***"=.001),
gof_omit    = "^(AIC|BIC|ICC|RMSE)$",
output      = out_file_oa
)
